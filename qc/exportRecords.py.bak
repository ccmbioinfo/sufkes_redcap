from exportRecordsChunked import exportRecordsChunked

def exportRecords(project, metadata, record_ids=None):
    # Determine whether or not to use chunked export by calculating approximate size of records.
    num_records =  len(project.export_records(records=record_ids, fields=[project.def_field])) # number of rows in records
    num_fields = len(metadata) # ~ number of columns in records
    
    if (num_records*num_fields < 1e6): # If number of cells in records <~ 1e6
        records = project.export_records(records=record_ids, export_data_access_groups=True)
    else:
        chunk_size = 400 # Timing for IPSS with DAGs: (200, 308s), (300, 296s), (400, 284s, 286s, 287s, 331s), (800, 283s)
        print "Exporting records in chunks of size", chunk_size
        records = exportRecordsChunked(project, record_ids=record_ids, chunk_size=chunk_size)
    return records
